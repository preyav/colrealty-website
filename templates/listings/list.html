{% extends "base.html" %}
{% load humanize %}
{% block content %}
<section class="listings-hero">
  <div>
    <h1 class="hero-title">
      Austin &amp; Central Texas <span class="hero-highlight">homes for sale</span>
    </h1>
    <p class="hero-text">
      Explore curated listings pulled directly from ACTRIS via MLS Grid.
      Updated automatically so you can keep buyers on your site instead of the portals.
    </p>

    <div class="hero-pills">
      <span class="hero-pill">ğŸ¡ Residential &amp; condos</span>
      <span class="hero-pill">ğŸ“ Austin Â· Cedar Park Â· Round Rock</span>
      <span class="hero-pill">âš¡ Real-time MLS updates</span>
    </div>
  </div>

  <div class="search-card">
    <div class="search-heading">
    </div>
	<form class="search-row" method="get" action="">
	  <input
		type="text"
		name="q"
		class="input-field"
		value="{{ request.GET.q|default_if_none:'' }}"
		placeholder="Search by city, neighborhood, street..."
	  />
	  <input
		type="text"
		name="price_min"
		class="input-field"
		value="{{ request.GET.price_min|default_if_none:'' }}"
		placeholder="Min price"
	  />
	  <input
		type="text"
		name="price_max"
		class="input-field"
		value="{{ request.GET.price_max|default_if_none:'' }}"
		placeholder="Max price"
	  />
	  <button type="submit" class="btn-primary">
		Search
	  </button>
	</form>
  </div>
</section>

<section>
  {% if listings %}
    <div class="listing-grid">
      {% for listing in listings %}
        <a href="{{ listing.get_absolute_url }}" class="listing-card">
          <div class="listing-image-wrap">
            {% if listing.main_image_url %}
              <img src="{{ listing.main_image_url }}" alt="{{ listing.title }}" class="listing-image">
            {% elif listing.main_image %}
              <img src="{{ listing.main_image.url }}" alt="{{ listing.title }}">
            {% endif %}

            <div class="badge-strip">
              <span class="badge badge-primary">
                {{ listing.property_type|default:"Property" }}
              </span>
              {% if listing.status == "active" %}
                <span class="badge badge-status-active">Active</span>
              {% elif listing.status == "pending" %}
                <span class="badge badge-status-pending">Pending</span>
              {% elif listing.status == "sold" %}
                <span class="badge badge-status-sold">Sold</span>
              {% endif %}
            </div>
          </div>

          <div class="listing-body">
            <div class="listing-price">
              <span class="price-main">
                ${{ listing.price|floatformat:0|intcomma }}
              </span>
              <span class="price-label">
                {% if listing.sqft %}
                  Â· {{ listing.sqft|intcomma }} sqft
                {% endif %}
              </span>
            </div>

            <h2 class="listing-title">
              {{ listing.title|truncatechars:60 }}
            </h2>

            <p class="listing-location">
              {{ listing.street_address }},
              {{ listing.city }}, {{ listing.state }} {{ listing.zip_code }}
            </p>

            <div class="listing-meta">
              {% if listing.beds %}
                <span class="meta-pill">{{ listing.beds }} bd</span>
              {% endif %}
              {% if listing.baths %}
                <span class="meta-pill">{{ listing.baths }} ba</span>
              {% endif %}
              {% if listing.lot_size %}
                <span class="meta-pill">{{ listing.lot_size }} ac lot</span>
              {% endif %}
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p>No listings found. Check back soon for new inventory.</p>
  {% endif %}
</section>
{% if is_paginated %}
  <nav class="pagination">
    {% if page_obj.has_previous %}
      <a href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k|urlencode }}={{ v|urlencode }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}">â† Prev</a>
    {% endif %}

    {% for p in paginator.page_range %}
      {% if p == page_obj.number %}
        <strong>{{ p }}</strong>
      {% else %}
        <a href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k|urlencode }}={{ v|urlencode }}&{% endif %}{% endfor %}page={{ p }}">{{ p }}</a>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k|urlencode }}={{ v|urlencode }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}">Next â†’</a>
    {% endif %}
  </nav>
{% endif %}

{% endblock %}
