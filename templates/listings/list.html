{% extends "base.html" %}
{% load static %}

{% block title %}Homes for Sale – Col Realty{% endblock %}

{% block content %}
<section class="bg-gradient-to-b from-sky-50 to-slate-50 border-b border-slate-200">
  <div class="max-w-6xl mx-auto px-4 pt-10 pb-6">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight text-slate-900 mb-2">
      Explore homes in Austin & Central Texas
    </h1>
    <p class="text-sm text-slate-600 mb-6 max-w-2xl">
      Filter by area, price, and bedrooms to find your next home or investment property.
    </p>

    <!-- Filters / search -->
    <form method="get"
          class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 flex flex-col md:flex-row gap-3 text-xs md:text-sm">
      <div class="flex-1">
        <label class="block text-[11px] font-medium text-slate-500 mb-1">
          City / ZIP
        </label>
        <input type="text" name="q"
               value="{{ request.GET.q }}"
               placeholder="Austin, Round Rock, 78704..."
               class="w-full px-3 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500/60 focus:border-sky-500">
      </div>
      <div class="w-full md:w-32">
        <label class="block text-[11px] font-medium text-slate-500 mb-1">
          Min Price
        </label>
        <input type="number" name="min_price"
               value="{{ request.GET.min_price }}"
               class="w-full px-3 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500/60 focus:border-sky-500">
      </div>
      <div class="w-full md:w-32">
        <label class="block text-[11px] font-medium text-slate-500 mb-1">
          Max Price
        </label>
        <input type="number" name="max_price"
               value="{{ request.GET.max_price }}"
               class="w-full px-3 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500/60 focus:border-sky-500">
      </div>
      <div class="w-full md:w-28">
        <label class="block text-[11px] font-medium text-slate-500 mb-1">
          Beds (min)
        </label>
        <input type="number" step="1" min="0" name="beds"
               value="{{ request.GET.beds }}"
               class="w-full px-3 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-500/60 focus:border-sky-500">
      </div>
      <div class="flex items-end">
        <button type="submit"
                class="w-full md:w-auto px-4 py-2.5 rounded-xl bg-sky-600 text-white font-medium hover:bg-sky-700 transition">
          Apply filters
        </button>
      </div>
    </form>

    <!-- Active filter summary -->
    {% if request.GET.q or request.GET.min_price or request.GET.max_price or request.GET.beds %}
      <p class="mt-3 text-[11px] text-slate-500">
        Showing results
        {% if request.GET.q %} in <span class="font-semibold">{{ request.GET.q }}</span>{% endif %}
        {% if request.GET.min_price %} from ${{ request.GET.min_price }}{% endif %}
        {% if request.GET.max_price %} to ${{ request.GET.max_price }}{% endif %}
        {% if request.GET.beds %} with at least {{ request.GET.beds }} beds{% endif %}.
        <a href="{% url 'listings:list' %}" class="ml-2 text-sky-600 hover:text-sky-700">Clear all</a>
      </p>
    {% endif %}
  </div>
</section>

<section class="max-w-6xl mx-auto px-4 py-8">
  {% if listings %}
    <p class="text-xs text-slate-500 mb-3">
      {{ page_obj.paginator.count }} home{{ page_obj.paginator.count|pluralize }} found.
    </p>

    <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
      {% for listing in listings %}
        <a href="{% url 'listings:detail' listing.pk %}"
           class="group bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition">
          <div class="aspect-[4/3] overflow-hidden">
            {% if listing.main_image_url %}
              <img src="{{ listing.main_image_url }}"
                   alt="{{ listing.title }}"
                   class="w-full h-full object-cover group-hover:scale-[1.03] transition-transform duration-300">
            {% else %}
              <div class="w-full h-full flex items-center justify-center text-slate-400 text-xs bg-slate-100">
                Photo coming soon
              </div>
            {% endif %}
          </div>
          <div class="p-3">
            <div class="flex items-center justify-between mb-1">
              <p class="text-sm font-semibold text-slate-900">
                ${{ listing.price|floatformat:0 }}
              </p>
              <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-sky-50 text-[10px] text-sky-700 font-medium">
                {{ listing.get_status_display }}
              </span>
            </div>
            <p class="text-[12px] text-slate-600">
              {{ listing.beds|default_if_none:"-" }} bd ·
              {{ listing.baths|default_if_none:"-" }} ba
              {% if listing.sqft %}
                · {{ listing.sqft|floatformat:0 }} sqft
              {% endif %}
            </p>
            <p class="mt-1 text-[11px] text-slate-500">
              {{ listing.street_address }} · {{ listing.city }}, {{ listing.state }} {{ listing.zip_code }}
            </p>
          </div>
        </a>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
      <div class="mt-8 flex items-center justify-center gap-2 text-xs">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}{% if request.GET.beds %}&beds={{ request.GET.beds }}{% endif %}"
             class="px-3 py-1.5 rounded-full border border-slate-300 text-slate-700 hover:bg-slate-100">
            ← Prev
          </a>
        {% endif %}

        <span class="px-3 py-1.5 text-slate-500">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.min_price %}&min_price={{ request.GET.min_price }}{% endif %}{% if request.GET.max_price %}&max_price={{ request.GET.max_price }}{% endif %}{% if request.GET.beds %}&beds={{ request.GET.beds }}{% endif %}"
             class="px-3 py-1.5 rounded-full border border-slate-300 text-slate-700 hover:bg-slate-100">
            Next →
          </a>
        {% endif %}
      </div>
    {% endif %}
  {% else %}
    <div class="bg-white border border-slate-200 rounded-2xl p-6 text-sm text-slate-600">
      <p class="font-medium mb-2">No homes match your search (yet).</p>
      <p class="mb-3">
        Try adjusting your filters, widening your area, or reducing price constraints.
        You can also reach out and we’ll keep an eye out for off-market or coming-soon opportunities.
      </p>
      <a href="{% url 'pages:home' %}" class="text-sky-600 hover:text-sky-700 text-xs">
        ← Back to Col Realty home
      </a>
    </div>
  {% endif %}
</section>
{% endblock %}
